{% extends 'base.html' %}
{% block title %}Predictions{% endblock %}
{% block content %}
<div class="card fade-in">
  <div class="card-header">
    <h5 class="card-title"><i class="fas fa-crystal-ball me-2"></i>Smart Spending Predictions</h5>
  </div>
  <div class="card-body">
    <form id="predictForm" onsubmit="predict(event)">
      <div class="mb-3">
        <label for="category" class="form-label">Select Expense Category:</label>
        <select class="form-select" id="category" required>
          <option value="">-- Choose Category --</option>
          <option value="Food">Food</option>
          <option value="Transport">Transport</option>
          <option value="Utilities">Utilities</option>
          <option value="Entertainment">Entertainment</option>
          <option value="Health">Health</option>
          <option value="Shopping">Shopping</option>
          <option value="Rent">Rent</option>
        </select>
      </div>
      <button type="submit" class="btn btn-primary mt-2">
        <i class="fas fa-magic me-1"></i> Predict
      </button>
    </form>

    <div class="mt-4">
      <canvas id="predictionChart" height="100"></canvas>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  async function predict(e) {
    e.preventDefault();
    const category = document.getElementById("category").value;
    if (!category) return;

    const response = await fetch("/predict", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ category })
    });

    const data = await response.json();
    if (data.predictions) {
      renderChart(data.category, data.predictions);
    }
  }

  function renderChart(category, predictions) {
    const ctx = document.getElementById("predictionChart").getContext("2d");
    if (window.predChart) window.predChart.destroy();

    window.predChart = new Chart(ctx, {
      type: "line",
      data: {
        labels: ["Month 1", "Month 2", "Month 3", "Month 4", "Month 5", "Month 6"],
        datasets: [{
          label: `${category} Expense Prediction (₹)`,
          data: predictions,
          fill: true,
          tension: 0.3,
          borderColor: "#3498db",
          backgroundColor: "rgba(52,152,219,0.2)",
          pointBackgroundColor: "#2980b9",
          pointRadius: 5
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: "top" },
          tooltip: { mode: "index", intersect: false }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: function (value) {
                return "₹" + value.toFixed(2);
              }
            }
          }
        }
      }
    });
  }
</script>
{% endblock %}
